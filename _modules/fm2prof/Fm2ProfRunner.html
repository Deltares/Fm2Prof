

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../_static/favicon.ico">
    
    
      
        <title>fm2prof.Fm2ProfRunner - FM2PROF documentation</title>
      
    
    
      <link rel="stylesheet" href="../../_static/stylesheets/main.42d9060c.min.css">
      
        
        <link rel="stylesheet" href="../../_static/stylesheets/palette.52561aa6.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" />
        <link rel="stylesheet" type="text/css" href="../../_static/stylesheets/extra.css" />
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deltares-blue" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="FM2PROF documentation" class="md-header__button md-logo" aria-label="FM2PROF documentation" data-md-component="logo">
      <img src="../../_static/Deltares_logo_Wit_RGB.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FM2PROF documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fm2prof.Fm2ProfRunner
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deltares-blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deltares-blue" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/deltares/fm2prof/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    deltares/fm2prof
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="FM2PROF documentation" class="md-nav__button md-logo" aria-label="FM2PROF documentation" data-md-component="logo">
      <img src="../../_static/Deltares_logo_Wit_RGB.svg" alt="logo">
    </a>
    FM2PROF documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/deltares/fm2prof/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    deltares/fm2prof
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/user_manual/installation.html" class="md-nav__link">
        <span class="md-ellipsis">Installation Instructions</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/user_manual/quickstart.html" class="md-nav__link">
        <span class="md-ellipsis">Tutorial</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/user_manual/advanced.html" class="md-nav__link">
        <span class="md-ellipsis">Troubleshooting</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/user_manual/source.html" class="md-nav__link">
        <span class="md-ellipsis">API</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/technical_manual/conceptual_design.html" class="md-nav__link">
        <span class="md-ellipsis">Conceptual design</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/technical_manual/numerical_methods.html" class="md-nav__link">
        <span class="md-ellipsis">Numerical methods</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/technical_manual/settings.html" class="md-nav__link">
        <span class="md-ellipsis">Settings</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/technical_manual/files.html" class="md-nav__link">
        <span class="md-ellipsis">Files</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../chapters/technical_manual/glossary.html" class="md-nav__link">
        <span class="md-ellipsis">Glossary of terms</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset" role="main">
                
<a href="https://github.com/deltares/fm2prof/blob/master/docs/_modules/fm2prof/Fm2ProfRunner.rst" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



  <h1>Source code for fm2prof.Fm2ProfRunner</h1><div class="highlight"><pre>
<span></span><code><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">geojson</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geojson</span> <span class="kn">import</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">FeatureCollection</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">ConvexHull</span>
<span class="kn">from</span> <span class="nn">fm2prof</span> <span class="kn">import</span> <span class="n">Functions</span> <span class="k">as</span> <span class="n">FE</span>
<span class="kn">from</span> <span class="nn">fm2prof</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">fm2prof.common</span> <span class="kn">import</span> <span class="n">FM2ProfBase</span>
<span class="kn">from</span> <span class="nn">fm2prof.CrossSection</span> <span class="kn">import</span> <span class="n">CrossSection</span>
<span class="kn">from</span> <span class="nn">fm2prof.Export</span> <span class="kn">import</span> <span class="n">Export1DModelData</span>
<span class="kn">from</span> <span class="nn">fm2prof.Import</span> <span class="kn">import</span> <span class="n">FMDataImporter</span><span class="p">,</span> <span class="n">FmModelData</span><span class="p">,</span> <span class="n">ImportInputFiles</span>
<span class="kn">from</span> <span class="nn">fm2prof.IniFile</span> <span class="kn">import</span> <span class="n">IniFile</span>
<span class="kn">from</span> <span class="nn">fm2prof.MaskOutputFile</span> <span class="kn">import</span> <span class="n">MaskOutputFile</span>
<span class="kn">from</span> <span class="nn">fm2prof.RegionPolygonFile</span> <span class="kn">import</span> <span class="n">RegionPolygonFile</span><span class="p">,</span> <span class="n">SectionPolygonFile</span>


<span class="k">class</span> <span class="nc">Fm2ProfRunner</span><span class="p">(</span><span class="n">FM2ProfBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class that executes all functionality.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        iniFilePath (str): path to configuration file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iniFilePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the project</span>

<span class="sd">        iniFilePath (str): path to a configuration file. If not given,</span>
<span class="sd">                               default values will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="p">:</span> <span class="n">FmModelData</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_logger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_header</span><span class="p">()</span>

        <span class="n">iniFilePath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">iniFilePath</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_inifile</span><span class="p">(</span><span class="n">iniFilePath</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exiting </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">has_output_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Output directory must be set in configuration file&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logfile</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">(),</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;fm2prof.log&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Print configuration to log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">print_configuration</span><span class="p">(),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to run FM2PROF.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;No ini file was specified and the run cannot go further.&quot;</span><span class="p">,</span> <span class="s2">&quot;Warning&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">succes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_inifile</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">succes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Program finished with errors&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Program finished&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_inifile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iniFilePath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use this method to load a configuration file from path.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            iniFilePath (str): path to configuration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">IniFileObject</span> <span class="o">=</span> <span class="n">IniFile</span><span class="p">(</span><span class="n">iniFilePath</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_inifile</span><span class="p">(</span><span class="n">IniFileObject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;FM2PROF version </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__copyright__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Authors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__authors__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Contact: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__contact__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;License: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__license__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2"> license. For more info see LICENSE.txt</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_inifile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Runs the desired emulation from 2d to 1d given the mapfile</span>
<span class="sd">            and the cross section file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            iniFile {IniFile}</span>
<span class="sd">                -- Object containing all the information</span>
<span class="sd">                    needed to execute the program</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Initialise the project</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_fm2prof</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during initialisation&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Generate cross-sections</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cross_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cross_section_list</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during generation of cross-sections. No output produced&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Finalise and write output</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalise_fm2prof</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Unexpected exception during finalisation&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Print final report</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_log_report</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during printing of log report&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_initialise_fm2prof</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads data, inifile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iniFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span>
        <span class="n">map_key</span> <span class="o">=</span> <span class="s2">&quot;2DMapOutput&quot;</span>
        <span class="n">css_key</span> <span class="o">=</span> <span class="s2">&quot;CrossSectionLocationFile&quot;</span>
        <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># shorter local variables</span>
        <span class="n">map_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">map_key</span><span class="p">)</span>
        <span class="n">css_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">css_key</span><span class="p">)</span>
        <span class="n">region_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;RegionPolygonFile&quot;</span><span class="p">)</span>
        <span class="n">section_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;SectionPolygonFile&quot;</span><span class="p">)</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span>

        <span class="c1"># Read region &amp; section polygon</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">region_file</span><span class="p">:</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="n">RegionPolygonFile</span><span class="p">(</span><span class="n">region_file</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">section_file</span><span class="p">):</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="n">SectionPolygonFile</span><span class="p">(</span><span class="n">section_file</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="c1"># Check if input exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">map_file</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File for </span><span class="si">{</span><span class="n">map_key</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">map_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span>
            <span class="p">)</span>
            <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">css_file</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File for </span><span class="si">{</span><span class="n">css_key</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">css_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span>
            <span class="p">)</span>
            <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">raiseFileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span>

        <span class="c1"># Read FM model data</span>
        <span class="n">fm2prof_fm_model_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_fm_model_data</span><span class="p">(</span>
            <span class="n">map_file</span><span class="p">,</span> <span class="n">css_file</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">sections</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span> <span class="o">=</span> <span class="n">FmModelData</span><span class="p">(</span><span class="n">fm2prof_fm_model_data</span><span class="p">)</span>

        <span class="n">ntsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">time_dependent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">time_dependent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;finished reading FM and cross-sectional data data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;Number of: timesteps (</span><span class="si">{}</span><span class="s2">), &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntsteps</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;faces (</span><span class="si">{}</span><span class="s2">), &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfaces</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;edges (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nedges</span><span class="p">),</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># check if edge/face data is available</span>
        <span class="k">if</span> <span class="s2">&quot;edge_faces&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">edge_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;FrictionweighingMethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Friction weighing set to 1 (area-weighted average&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;but FM map file does contain the *edge_faces* keyword.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Area weighting is not possible. Defaulting to simple unweighted&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;averaging&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalise_fm2prof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write to output, perform checks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_log_task</span><span class="p">(</span><span class="s2">&quot;Finalizing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Interpolating roughness&quot;</span><span class="p">)</span>
        <span class="n">FE</span><span class="o">.</span><span class="n">interpolate_roughness</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">)</span>

        <span class="c1"># Export cross sections</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Export model input files to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Generate output geojson</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">export_mapfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;ExportMapFiles&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If key is missing, do not export files by default.</span>
            <span class="c1"># We need a better solution for this (inifile.getparam?.. handle defaults there?)</span>
            <span class="n">export_mapfiles</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">export_mapfiles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Export geojson output to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_geojson_output</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">)</span>

        <span class="c1"># Export bounding boxes of cross-section control volumes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_envelope</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Error while exporting bounding boxes&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">e_message</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # Export envelopes around cross-sections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">}</span>
        <span class="n">css_hulls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">css</span> <span class="ow">in</span> <span class="n">cross_sections</span><span class="p">:</span>
            <span class="n">pointlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">point</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">css</span><span class="o">.</span><span class="n">get_point_list</span><span class="p">(</span><span class="s2">&quot;face&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># construct envelope</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">pointlist</span><span class="p">)</span>
                <span class="n">css_hulls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Feature</span><span class="p">(</span>
                        <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">css</span><span class="o">.</span><span class="n">name</span><span class="p">},</span>
                        <span class="n">geometry</span><span class="o">=</span><span class="n">Polygon</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pointlist</span><span class="p">[</span><span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">]))]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Hull Exported For </span><span class="si">{</span><span class="n">css</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;cross_section_volumes.geojson&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">geojson</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">css_hulls</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_fm_model_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_file</span><span class="p">,</span> <span class="n">css_file</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">sections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads input files for &#39;FM2PROF&#39;. See documentation for file format descriptions.</span>

<span class="sd">        Data is saved in three major structures:</span>
<span class="sd">            time_independent_data: holds bathymetry information</span>
<span class="sd">            time_dependent_data: waterlevels, roughnesses and velocities</span>
<span class="sd">            edge_data: the nodes that relate to edges</span>

<span class="sd">        :param res_file: str, path to FlowFM map netcfd file (*_map.nc)</span>
<span class="sd">        :param css_file: str, path to cross-section definition file</span>
<span class="sd">        :param region_file: str, path to region geojson file</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">importer</span> <span class="o">=</span> <span class="n">ImportInputFiles</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>
        <span class="n">ini_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span>

        <span class="c1"># Read FM map file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Opening FM Map file&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span>
            <span class="n">edge_data</span><span class="p">,</span>
            <span class="n">node_coordinates</span><span class="p">,</span>
            <span class="n">time_dependent_data</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">FMDataImporter</span><span class="p">()</span><span class="o">.</span><span class="n">import_dflow2d</span><span class="p">(</span><span class="n">res_file</span><span class="p">)</span>
        <span class="c1"># (ctime_independent_data, cedge_data, cnode_coordinates, ctime_dependent_data) = FE._read_fm_model(res_file)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Closed FM Map file&quot;</span><span class="p">)</span>

        <span class="c1"># Load locations and names of cross-sections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Opening css file&quot;</span><span class="p">)</span>
        <span class="n">cssdata</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">css_file</span><span class="p">(</span><span class="n">css_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Closed css file&quot;</span><span class="p">)</span>

        <span class="c1"># Classify regions &amp; set cross-sections</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">regions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;All 2D points assigned to the same region and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_without_regions</span><span class="p">(</span>
                <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to regions using DeltaShell and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_with_deltashell</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;region&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to regions using Built-In method and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_with_builtin_methods</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">regions</span>
            <span class="p">)</span>

        <span class="c1"># Classify sections for roughness tables</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning point to sections without polygons&quot;</span><span class="p">)</span>
            <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_roughness_sections_by_variance</span><span class="p">(</span>
                <span class="n">edge_data</span><span class="p">,</span> <span class="n">time_dependent_data</span><span class="p">[</span><span class="s2">&quot;chezy_edge&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_roughness_sections_by_variance</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">time_dependent_data</span><span class="p">[</span><span class="s2">&quot;chezy_mean&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning 2D points to sections using DeltaShell&quot;</span><span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_section_with_deltashell</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to sections using Built-In method&quot;</span>
            <span class="p">)</span>
            <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_roughness_sections_by_polygon</span><span class="p">(</span>
                <span class="n">sections</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_roughness_sections_by_polygon</span><span class="p">(</span>
                <span class="n">sections</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">time_dependent_data</span><span class="p">,</span>
            <span class="n">time_independent_data</span><span class="p">,</span>
            <span class="n">edge_data</span><span class="p">,</span>
            <span class="n">node_coordinates</span><span class="p">,</span>
            <span class="n">cssdata</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_classify_with_builtin_methods</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">polygons</span>
    <span class="p">):</span>
        <span class="c1"># Determine in which region each cross-section lies</span>
        <span class="n">css_regions</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">cssdata</span><span class="p">[</span><span class="s2">&quot;xy&quot;</span><span class="p">])</span>

        <span class="c1"># Determine in which region each 2d point lies</span>
        <span class="n">xy_tuples_2d</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)))</span>
        <span class="p">]</span>

        <span class="n">time_independent_data</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">xy_tuples_2d</span><span class="p">)</span>

        <span class="n">xy_tuples_2d</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)))</span>
        <span class="p">]</span>

        <span class="n">edge_data</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">xy_tuples_2d</span><span class="p">)</span>

        <span class="c1"># Do Nearest neighbour cross-section for each region</span>
        <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_with_regions</span><span class="p">(</span>
            <span class="n">regions</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">css_regions</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

    <span class="k">def</span> <span class="nf">_classify_section_with_deltashell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">):</span>

        <span class="c1"># Determine in which section each 2D point lies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning faces...&quot;</span><span class="p">)</span>
        <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;section&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning edges...&quot;</span><span class="p">)</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">edge_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;section&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

    <span class="k">def</span> <span class="nf">_classify_with_deltashell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">polygons</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;region&quot;</span>
    <span class="p">):</span>

        <span class="c1"># Determine in which region each 2D point lies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning faces...&quot;</span><span class="p">)</span>
        <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="n">polytype</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning edges...&quot;</span><span class="p">)</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">edge_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="n">polytype</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;Assigning cross-sections using nearest neighbour within regions...&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Determine in which region each cross-section lies</span>
        <span class="n">css_regions</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">cssdata</span><span class="p">[</span><span class="s2">&quot;xy&quot;</span><span class="p">])</span>

        <span class="c1"># Do Nearest neighbour cross-section for each region</span>
        <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_with_regions</span><span class="p">(</span>
            <span class="n">polygons</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">css_regions</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

<div class="viewcode-block" id="Fm2ProfRunner._classify_roughness_sections_by_variance"><a class="viewcode-back" href="../../chapters/technical_manual/numerical_methods.html#fm2prof.Fm2ProfRunner.Fm2ProfRunner._classify_roughness_sections_by_variance">[docs]</a>    <span class="k">def</span> <span class="nf">_classify_roughness_sections_by_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method classifies the region into main channel and floodplain based on roughness. It</span>
<span class="sd">        is used when the user does not specify a section polygon.</span>

<span class="sd">        This method assumes that the main channel is much deeper than the floodplain. Therefore,</span>
<span class="sd">        the Chzy values will be higher than those in the floodplain. The objective is now to</span>
<span class="sd">        define a split-value that minimizes the variance of the split sets.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Variance reduction classification is method often used in decision tree learning,</span>
<span class="sd">            e.g. see https://en.wikipedia.org/wiki/Decision_tree_learning#Variance_reduction</span>
<span class="sd">            for more information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get chezy values at last timestep</span>
        <span class="n">end_values</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span>

        <span class="c1"># Find split point (chezy value) by variance minimisation</span>
        <span class="n">variance_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">split_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">end_values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">end_values</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">split_candidates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span>
        <span class="p">):</span>  <span class="c1"># this means that all end values are very close together, so do not split</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">split_candidates</span><span class="p">:</span>
                <span class="n">variance_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">end_values</span><span class="p">[</span><span class="n">end_values</span> <span class="o">&gt;</span> <span class="n">split</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">end_values</span><span class="p">[</span><span class="n">end_values</span> <span class="o">&lt;=</span> <span class="n">split</span><span class="p">]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">splitpoint</span> <span class="o">=</span> <span class="n">split_candidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">variance_list</span><span class="p">)]</span>

            <span class="c1"># High chezy values are assigned to section number &#39;1&#39; (Main channel)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">end_values</span> <span class="o">&gt;</span> <span class="n">splitpoint</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Low chezy values are assigned to section number &#39;2&#39; (Flood plain)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">end_values</span> <span class="o">&lt;=</span> <span class="n">splitpoint</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">_get_region_map_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polytype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path to a NC file with region ifnormation in the bathymetry data&quot;&quot;&quot;</span>
        <span class="n">map_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;2DMapOutput&quot;</span><span class="p">)</span>
        <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">map_file_path</span><span class="p">)</span>
        <span class="n">modified_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polytype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">BATHY</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">modified_file_path</span>

    <span class="k">def</span> <span class="nf">_assign_polygon_using_deltashell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign all 2D points using DeltaShell method&quot;&quot;&quot;</span>

        <span class="c1"># NOTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for _</span><span class="si">{</span><span class="n">polytype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">BATHY.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>

        <span class="n">path_to_modified_nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_region_map_file</span><span class="p">(</span><span class="n">polytype</span><span class="p">)</span>

        <span class="c1"># Load Modified NetCDF</span>
        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_to_modified_nc</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
            <span class="c1"># Data stored in node z, while fm2prof uses data at faces or edges.</span>
            <span class="n">region_at_node</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mesh2d_node_z&quot;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;face&quot;</span><span class="p">:</span>
                <span class="n">node_to_face</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mesh2d_face_nodes&quot;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">region_at_face</span> <span class="o">=</span> <span class="n">region_at_node</span><span class="p">[</span><span class="n">node_to_face</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">polytype</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_at_face</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="n">node_to_edge</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;edge_nodes&quot;</span><span class="p">]</span>
                <span class="n">region_at_edge</span> <span class="o">=</span> <span class="n">region_at_node</span><span class="p">[</span><span class="n">node_to_edge</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">polytype</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_at_edge</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_generate_geojson_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates geojson file based on cross sections.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            output_dir {str} -- Output directory path.</span>
<span class="sd">            cross_sections {list} -- List of Cross Sections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pointtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="s2">&quot;edge&quot;</span><span class="p">]:</span>
            <span class="n">output_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_output.geojson&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pointtype</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_points</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">node_point</span>
                    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">cross_sections</span>
                    <span class="k">for</span> <span class="n">node_point</span> <span class="ow">in</span> <span class="n">cs</span><span class="o">.</span><span class="n">get_point_list</span><span class="p">(</span><span class="n">pointtype</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Collected points, dumping to file&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span>
                <span class="p">)</span>
                <span class="n">MaskOutputFile</span><span class="o">.</span><span class="n">write_mask_output_file</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">node_points</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Error while generation .geojson file,&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;Reason: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_cross_section_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates cross sections based on the given fm_model_data</span>

<span class="sd">        Arguments:</span>
<span class="sd">            input_param_dict {Mapping[str, list]}</span>
<span class="sd">                -- Dictionary of parameters read from IniFile</span>
<span class="sd">            fm_model_data {FmModelData}</span>
<span class="sd">                -- Class with all necessary data for generating Cross Sections</span>

<span class="sd">        Returns:</span>
<span class="sd">            {list} -- List of generated cross sections</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cross_sections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cross_sections</span>

        <span class="c1"># Preprocess css from fm_model_data so it&#39;s easier to handle it.</span>
        <span class="n">css_data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">css_data_list</span>

        <span class="c1"># Set the number of cross-section for progress bar</span>
        <span class="n">css_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_css_range</span><span class="p">(</span><span class="n">number_of_css</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">css_data_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">set_number_of_iterations</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">css_selection</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Generate cross-sections one by one</span>
        <span class="k">for</span> <span class="n">css_data</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">css_data_list</span><span class="p">)[</span><span class="n">css_selection</span><span class="p">]:</span>
            <span class="n">generated_cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cross_section</span><span class="p">(</span>
                <span class="n">css_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">generated_cross_section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cross_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generated_cross_section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_sections</span>

    <span class="k">def</span> <span class="nf">_get_css_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_css</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses the CssSelection keyword from the inifile&quot;&quot;&quot;</span>
        <span class="n">cssSelection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;CssSelection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cssSelection</span><span class="p">:</span>
            <span class="n">cssSelection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_css</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cssSelection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cssSelection</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cssSelection</span>

    <span class="k">def</span> <span class="nf">_generate_cross_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">css_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">fm_model_data</span><span class="p">:</span> <span class="n">FmModelData</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generates a cross section and configures its values based</span>
<span class="sd">        on the input parameter dictionary</span>

<span class="sd">        Arguments:</span>
<span class="sd">            css_data {dict}</span>
<span class="sd">                -- Dictionary of data for the current cross section</span>
<span class="sd">            input_param_dict {Mapping[str,list]}</span>
<span class="sd">                -- Dictionary with input parameters</span>
<span class="sd">            fm_model_data {FmModelData}</span>
<span class="sd">                -- Data to assign to the new cross section</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If no css_data is given.</span>
<span class="sd">            Exception: If no input_param_dict is given.</span>
<span class="sd">            Exception: If no fm_model_data is given.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {CrossSection} -- New Cross Section</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">css_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No data was given to create a Cross Section&quot;</span><span class="p">)</span>

        <span class="n">css_name</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_name</span><span class="p">:</span>
            <span class="n">css_name</span> <span class="o">=</span> <span class="s2">&quot;new_cross_section&quot;</span>

        <span class="k">if</span> <span class="n">fm_model_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;No FM data given for new cross section </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_log_task</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">css_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create cross section</span>
        <span class="n">created_css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_new_cross_section</span><span class="p">(</span><span class="n">css_data</span><span class="o">=</span><span class="n">css_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">created_css</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No Cross-section could be generated for </span><span class="si">{</span><span class="n">css_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">created_css</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There are too little 2D points in control volume to construct cross-section&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Initiated new cross-section&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cross_section_geometry</span><span class="p">(</span><span class="n">cross_section</span><span class="o">=</span><span class="n">created_css</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cross_section_roughness</span><span class="p">(</span><span class="n">cross_section</span><span class="o">=</span><span class="n">created_css</span><span class="p">)</span>

        <span class="c1"># if self.get_inifile().get_parameter(&#39;ExportMapFiles&#39;):</span>
        <span class="n">created_css</span><span class="o">.</span><span class="n">set_face_output_list</span><span class="p">()</span>
        <span class="n">created_css</span><span class="o">.</span><span class="n">set_edge_output_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">created_css</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">get_elapsed_time</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cross-section </span><span class="si">{</span><span class="n">created_css</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> derived in </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">created_css</span>

    <span class="k">def</span> <span class="nf">_build_cross_section_geometry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method manages the options of buildling the cross-section geometry</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cross_section {CrossSection}</span>
<span class="sd">                -- Given Cross Section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cross_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">css_name</span> <span class="o">=</span> <span class="n">cross_section</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Build cross-section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Start building geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">build_geometry</span><span class="p">()</span>

        <span class="c1"># 2D Volume Correction (SummerDike option)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;SDCorrection&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Starting correction&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="n">cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_2D_volume_correction</span><span class="p">(</span><span class="n">cross_section</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;SD Correction not enable in configuration file, skipping&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Perform sanity check on cross-section</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">check_requirements</span><span class="p">()</span>

        <span class="c1"># Reduce number of points in cross-section</span>
        <span class="n">cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_css_points</span><span class="p">(</span><span class="n">cross_section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_build_cross_section_roughness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the roughness tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Assign roughness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Starting computing roughness tables&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">assign_roughness</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Computed roughness&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_get_new_cross_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">css_data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Creates a cross section with the given input param dictionary.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            css_data {Mapping[str, str]}</span>
<span class="sd">                -- FM Model data for cross section.</span>
<span class="sd">            input_param_dict {Mapping[str, str]}</span>
<span class="sd">                -- Dictionary with parameters for Cross Section.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {CrossSection} -- New cross section object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get id data and id index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">css_data_id</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_data_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get remainig data</span>
        <span class="n">css_data_length</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">)</span>
        <span class="n">css_data_location</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
        <span class="n">css_data_branch_id</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branchid&quot;</span><span class="p">)</span>
        <span class="n">css_data_chainage</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chainage&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">css_data_length</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_location</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_branch_id</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_chainage</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="n">CrossSection</span><span class="p">(</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(),</span>
                <span class="n">inifile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">(),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">css_data_id</span><span class="p">,</span>
                <span class="n">length</span><span class="o">=</span><span class="n">css_data_length</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">css_data_location</span><span class="p">,</span>
                <span class="n">branchid</span><span class="o">=</span><span class="n">css_data_branch_id</span><span class="p">,</span>
                <span class="n">chainage</span><span class="o">=</span><span class="n">css_data_chainage</span><span class="p">,</span>
                <span class="n">fm_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">get_selection</span><span class="p">(</span><span class="n">css_data_id</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown while creating cross-section &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_data_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">css</span>

    <span class="k">def</span> <span class="nf">_write_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports all cross sections to the necessary file formats</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cross_sections {list}</span>
<span class="sd">                -- List of created cross sections</span>
<span class="sd">            output_dir {str}</span>
<span class="sd">                -- target directory where to export all the cross sections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cross_sections</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_dir</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">OutputExporter</span> <span class="o">=</span> <span class="n">Export1DModelData</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="c1"># File paths</span>
        <span class="n">css_location_ini_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;CrossSectionLocations.ini&quot;</span><span class="p">)</span>
        <span class="n">css_definitions_ini_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;CrossSectionDefinitions.ini&quot;</span>
        <span class="p">)</span>

        <span class="n">csv_geometry_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">geometry.csv&quot;</span>
        <span class="n">csv_roughness_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness.csv&quot;</span>

        <span class="n">csv_geometry_test_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">geometry_test.csv&quot;</span>
        <span class="n">csv_roughness_test_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness_test.csv&quot;</span>

        <span class="n">csv_volumes_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">volumes.csv&quot;</span>

        <span class="c1"># export fm1D format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Export locations</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_crossSectionLocations</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">css_location_ini_file</span>
            <span class="p">)</span>

            <span class="c1"># Export definitions</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">css_definitions_ini_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;dflow1d&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Export roughness</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">css</span> <span class="ow">in</span> <span class="n">cross_sections</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">css</span><span class="o">.</span><span class="n">friction_tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="p">)</span>
            <span class="n">sectionFileKeyDict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-Main.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;Main&quot;</span><span class="p">],</span>
                <span class="s2">&quot;floodplain1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-FloodPlain1.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;FloodPlain1&quot;</span><span class="p">],</span>
                <span class="s2">&quot;floodplain2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-FloodPlain2.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;FloodPlain2&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
                <span class="n">csv_roughness_ini_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="n">sectionFileKeyDict</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_roughness</span><span class="p">(</span>
                    <span class="n">cross_sections</span><span class="p">,</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">csv_roughness_ini_file</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;dflow1d&quot;</span><span class="p">,</span>
                    <span class="n">roughness_section</span><span class="o">=</span><span class="n">sectionFileKeyDict</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files to DIMR format,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Eport SOBEK 3 format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Cross-sections</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_geometry_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;sobek3&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Roughness</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_roughness</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_roughness_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;sobek3&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files to SOBEK format,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Other files:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_geometry_test_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;testformat&quot;</span>
            <span class="p">)</span>

            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_volumes</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_volumes_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Exported output files, FM2PROF finished&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reduce_css_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a valid value for the number of css points read from ini file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cross_section (CrossSection)</span>

<span class="sd">        Returns:</span>
<span class="sd">            cross_section (CrossSection): modified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">maximum_number_of_css_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;MaximumPointsInProfile&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cross_section</span><span class="o">.</span><span class="n">reduce_points</span><span class="p">(</span><span class="n">count_after</span><span class="o">=</span><span class="n">maximum_number_of_css_points</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown while trying to reduce the css points. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_message</span><span class="p">),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_get_time_stamp_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a time stamp with the time difference</span>

<span class="sd">        Arguments:</span>
<span class="sd">            start_time {datetime} -- Initial date time</span>

<span class="sd">        Returns:</span>
<span class="sd">            {float} -- difference of time between start and now in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_difference</span> <span class="o">=</span> <span class="n">time_now</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">return</span> <span class="n">time_difference</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_perform_2D_volume_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">css</span><span class="p">:</span> <span class="n">CrossSection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In 2D, the volume available in a profile can rise rapidly</span>
<span class="sd">        while the water level changes little due to compartimentalisation</span>
<span class="sd">        of the floodplain. This methods calculates a logistic correction</span>
<span class="sd">        term which may be applied in 1D models.</span>

<span class="sd">        In SOBEK this option is available as the &#39;summerdike&#39; options.</span>
<span class="sd">        Calculates the Cross Section correction if needed.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">css</span><span class="o">.</span><span class="n">calculate_correction</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;correction finished&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;while trying to calculate the correction. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_message</span><span class="p">),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">css</span>

    <span class="k">def</span> <span class="nf">_print_log_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">_loglibrary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warnings: </span><span class="si">{</span><span class="n">ll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Errors: </span><span class="si">{</span><span class="n">ll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Project"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project">[docs]</a><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">Fm2ProfRunner</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides the python API for running FM2PROF.</span>

<span class="sd">    Instantiate by providing the path to a configuration file</span>

<span class="sd">    &gt;&gt; Project(&#39;/path/to/config.ini&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Project.set_parameter"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the value of a parameter</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the parameter (case insensitive).</span>

<span class="sd">            value: value of the parameter. An error will be given if the value has the wrong type (e.g. string if int was expected).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_parameter"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to get the value of a parameter</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the parameter (case insensitive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current value of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.set_input_file"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the path to an input file</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the input file in the configuration (case insensitive).</span>

<span class="sd">            value: path to the inputfile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_input_file</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_input_file"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to retrieve the path to an input file</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (str): case-insensitive key of the input file (e.g.&#39;2dmapoutput&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.set_output_directory"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_output_directory">[docs]</a>    <span class="k">def</span> <span class="nf">set_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the output directory.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            calling this function will also create the output directory,</span>
<span class="sd">            if it does not already exists!</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: path to the output path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_output_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_output_directory"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_output_directory">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current output directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span></div>

<div class="viewcode-block" id="Project.print_configuration"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.print_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">print_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to obtain string representation of the</span>
<span class="sd">        configuration. Use this string to write to file, e.g.:</span>

<span class="sd">            &gt;&gt; with open(&#39;EmptyProject.ini&#39;, &#39;w&#39;) as f:</span>
<span class="sd">            &gt;&gt;     f.write(project.print_configuration())</span>

<span class="sd">        Returns:</span>
<span class="sd">            string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">print_configuration</span><span class="p">()</span></div></div>
</code></pre></div>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      May 28, 2022
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022 Deltares.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    4.5.0.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../_static/javascripts/bundle.cf32e622.min.js"></script>
        <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
        <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
  </body>
</html>