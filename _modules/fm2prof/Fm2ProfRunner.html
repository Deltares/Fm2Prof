<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>fm2prof.Fm2ProfRunner &#8212; FM2PROF 1.4.3 documentation</title>

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/material-icons.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" />
    <link rel="stylesheet" href="../../_static/notosanscjkjp.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/roboto.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material-design-lite-1.3.0/material.indigo-blue.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_materialdesign_theme.css" type="text/css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script src="../../_static/sphinx_materialdesign_theme.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link" href="../index.html">Module code</a><i class="material-icons">navigate_next</i>
            <a class="mdl-navigation__link is-active">fm2prof.Fm2ProfRunner</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="../../search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
          <a  class="mdl-navigation__link" href="../../index.html">
                  <i class="material-icons navigation-link-icon">home</i>
                  Home
              </a>
          
              <a  class="mdl-navigation__link" href="https://deltares.nl">
                  <i class="material-icons navigation-link-icon">launch</i>
                  Deltares
              </a>
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../../index.html">
              <img class="logo" src="../../_static/logo_deltares.png" alt="FM2PROF"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/user_manual/index.html">User Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/installation.html">Installation Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/advanced.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/source.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/technical_manual/index.html">Technical Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/conceptual_design.html">Conceptual design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/numerical_methods.html">Numerical methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/files.html">Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/glossary.html">Glossary of terms</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="../../index.html">
              <img class="logo" src="../../_static/logo_deltares.png" alt="FM2PROF"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/user_manual/index.html">User Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/installation.html">Installation Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/advanced.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/user_manual/source.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/technical_manual/index.html">Technical Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/conceptual_design.html">Conceptual design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/numerical_methods.html">Numerical methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/files.html">Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chapters/technical_manual/glossary.html">Glossary of terms</a></li>
</ul>
</li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <h1>Source code for fm2prof.Fm2ProfRunner</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Runner class.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># import from standard library</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">geojson</span>

<span class="c1"># import from dependencies</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geojson</span> <span class="kn">import</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">FeatureCollection</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">ConvexHull</span>

<span class="kn">from</span> <span class="nn">fm2prof</span> <span class="kn">import</span> <span class="n">Functions</span> <span class="k">as</span> <span class="n">FE</span>
<span class="kn">from</span> <span class="nn">fm2prof</span> <span class="kn">import</span> <span class="n">__version__</span>

<span class="c1"># import from package</span>
<span class="kn">from</span> <span class="nn">fm2prof.common</span> <span class="kn">import</span> <span class="n">FM2ProfBase</span>
<span class="kn">from</span> <span class="nn">fm2prof.CrossSection</span> <span class="kn">import</span> <span class="n">CrossSection</span>
<span class="kn">from</span> <span class="nn">fm2prof.Export</span> <span class="kn">import</span> <span class="n">Export1DModelData</span>
<span class="kn">from</span> <span class="nn">fm2prof.Import</span> <span class="kn">import</span> <span class="n">FMDataImporter</span><span class="p">,</span> <span class="n">FmModelData</span><span class="p">,</span> <span class="n">ImportInputFiles</span>
<span class="kn">from</span> <span class="nn">fm2prof.IniFile</span> <span class="kn">import</span> <span class="n">IniFile</span>
<span class="kn">from</span> <span class="nn">fm2prof.MaskOutputFile</span> <span class="kn">import</span> <span class="n">MaskOutputFile</span>
<span class="kn">from</span> <span class="nn">fm2prof.RegionPolygonFile</span> <span class="kn">import</span> <span class="n">RegionPolygonFile</span><span class="p">,</span> <span class="n">SectionPolygonFile</span>


<span class="k">class</span> <span class="nc">Fm2ProfRunner</span><span class="p">(</span><span class="n">FM2ProfBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class that executes all functionality.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        iniFilePath (str): path to configuration file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iniFilePath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the project</span>

<span class="sd">        iniFilePath (str): path to a configuration file. If not given,</span>
<span class="sd">                               default values will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="p">:</span> <span class="n">FmModelData</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_logger</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_header</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_inifile</span><span class="p">(</span><span class="n">iniFilePath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exiting&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">has_output_directory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Output directory must be set in configuration file&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logfile</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">(),</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;fm2prof.log&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Print configuration to log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">print_configuration</span><span class="p">(),</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to run FM2PROF.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;No ini file was specified and the run cannot go further.&quot;</span><span class="p">,</span> <span class="s2">&quot;Warning&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">succes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_inifile</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">succes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Program finished with errors&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Program finished&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_inifile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iniFilePath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use this method to load a configuration file from path.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            iniFilePath (str): path to configuration file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">IniFileObject</span> <span class="o">=</span> <span class="n">IniFile</span><span class="p">(</span><span class="n">iniFilePath</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_inifile</span><span class="p">(</span><span class="n">IniFileObject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;FM2PROF version </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__copyright__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Authors: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__authors__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Contact: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__contact__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;License: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__license__</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2"> license. For more info see LICENSE.txt</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_inifile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Runs the desired emulation from 2d to 1d given the mapfile</span>
<span class="sd">            and the cross section file.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            iniFile {IniFile}</span>
<span class="sd">                -- Object containing all the information</span>
<span class="sd">                    needed to execute the program</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Initialise the project</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_fm2prof</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during initialisation&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Generate cross-sections</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cross_sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cross_section_list</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during generation of cross-sections. No output produced&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Finalise and write output</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalise_fm2prof</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Unexpected exception during finalisation&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Print final report</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_log_report</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected exception during printing of log report&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_initialise_fm2prof</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads data, inifile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iniFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span>
        <span class="n">map_key</span> <span class="o">=</span> <span class="s2">&quot;2DMapOutput&quot;</span>
        <span class="n">css_key</span> <span class="o">=</span> <span class="s2">&quot;CrossSectionLocationFile&quot;</span>
        <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># shorter local variables</span>
        <span class="n">map_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">map_key</span><span class="p">)</span>
        <span class="n">css_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">css_key</span><span class="p">)</span>
        <span class="n">region_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;RegionPolygonFile&quot;</span><span class="p">)</span>
        <span class="n">section_file</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;SectionPolygonFile&quot;</span><span class="p">)</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span>

        <span class="c1"># Read region &amp; section polygon</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">region_file</span><span class="p">:</span>
            <span class="n">regions</span> <span class="o">=</span> <span class="n">RegionPolygonFile</span><span class="p">(</span><span class="n">region_file</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">section_file</span><span class="p">):</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="n">SectionPolygonFile</span><span class="p">(</span><span class="n">section_file</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="c1"># Check if input exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">map_file</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File for </span><span class="si">{</span><span class="n">map_key</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">map_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span>
            <span class="p">)</span>
            <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">css_file</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File for </span><span class="si">{</span><span class="n">css_key</span><span class="si">}</span><span class="s2"> not found at </span><span class="si">{</span><span class="n">css_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span>
            <span class="p">)</span>
            <span class="n">raiseFileNotFoundError</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">raiseFileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span>

        <span class="c1"># Read FM model data</span>
        <span class="n">fm2prof_fm_model_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_fm_model_data</span><span class="p">(</span>
            <span class="n">map_file</span><span class="p">,</span> <span class="n">css_file</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">sections</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span> <span class="o">=</span> <span class="n">FmModelData</span><span class="p">(</span><span class="n">fm2prof_fm_model_data</span><span class="p">)</span>

        <span class="n">ntsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">time_dependent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">time_dependent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;waterlevel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nedges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;finished reading FM and cross-sectional data data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;Number of: timesteps (</span><span class="si">{}</span><span class="s2">), &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntsteps</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;faces (</span><span class="si">{}</span><span class="s2">), &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfaces</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;edges (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nedges</span><span class="p">),</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># check if edge/face data is available</span>
        <span class="k">if</span> <span class="s2">&quot;edge_faces&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">edge_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iniFile</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;FrictionweighingMethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Friction weighing set to 1 (area-weighted average&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;but FM map file does contain the *edge_faces* keyword.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;Area weighting is not possible. Defaulting to simple unweighted&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;averaging&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finalise_fm2prof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write to output, perform checks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_log_task</span><span class="p">(</span><span class="s2">&quot;Finalizing&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Interpolating roughness&quot;</span><span class="p">)</span>
        <span class="n">FE</span><span class="o">.</span><span class="n">interpolate_roughness</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">)</span>

        <span class="c1"># Export cross sections</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Export model input files to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Generate output geojson</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">export_mapfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;ExportMapFiles&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If key is missing, do not export files by default.</span>
            <span class="c1"># We need a better solution for this (inifile.getparam?.. handle defaults there?)</span>
            <span class="n">export_mapfiles</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">export_mapfiles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Export geojson output to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_dir</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_geojson_output</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">)</span>

        <span class="c1"># Export bounding boxes of cross-section control volumes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_envelope</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Error while exporting bounding boxes&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">e_message</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_envelope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # Export envelopes around cross-sections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">}</span>
        <span class="n">css_hulls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">css</span> <span class="ow">in</span> <span class="n">cross_sections</span><span class="p">:</span>
            <span class="n">pointlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">point</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">css</span><span class="o">.</span><span class="n">get_point_list</span><span class="p">(</span><span class="s2">&quot;face&quot;</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># construct envelope</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">pointlist</span><span class="p">)</span>
                <span class="n">css_hulls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Feature</span><span class="p">(</span>
                        <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">css</span><span class="o">.</span><span class="n">name</span><span class="p">},</span>
                        <span class="n">geometry</span><span class="o">=</span><span class="n">Polygon</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pointlist</span><span class="p">[</span><span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">]))]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No Hull Exported For </span><span class="si">{</span><span class="n">css</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;cross_section_volumes.geojson&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">geojson</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">css_hulls</span><span class="p">),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_fm_model_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_file</span><span class="p">,</span> <span class="n">css_file</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">sections</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads input files for &#39;FM2PROF&#39;. See documentation for file format descriptions.</span>

<span class="sd">        Data is saved in three major structures:</span>
<span class="sd">            time_independent_data: holds bathymetry information</span>
<span class="sd">            time_dependent_data: waterlevels, roughnesses and velocities</span>
<span class="sd">            edge_data: the nodes that relate to edges</span>

<span class="sd">        :param res_file: str, path to FlowFM map netcfd file (*_map.nc)</span>
<span class="sd">        :param css_file: str, path to cross-section definition file</span>
<span class="sd">        :param region_file: str, path to region geojson file</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">importer</span> <span class="o">=</span> <span class="n">ImportInputFiles</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>
        <span class="n">ini_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span>

        <span class="c1"># Read FM map file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Opening FM Map file&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span>
            <span class="n">edge_data</span><span class="p">,</span>
            <span class="n">node_coordinates</span><span class="p">,</span>
            <span class="n">time_dependent_data</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">FMDataImporter</span><span class="p">()</span><span class="o">.</span><span class="n">import_dflow2d</span><span class="p">(</span><span class="n">res_file</span><span class="p">)</span>
        <span class="c1"># (ctime_independent_data, cedge_data, cnode_coordinates, ctime_dependent_data) = FE._read_fm_model(res_file)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Closed FM Map file&quot;</span><span class="p">)</span>

        <span class="c1"># Load locations and names of cross-sections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Opening css file&quot;</span><span class="p">)</span>
        <span class="n">cssdata</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">css_file</span><span class="p">(</span><span class="n">css_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Closed css file&quot;</span><span class="p">)</span>

        <span class="c1"># Classify regions &amp; set cross-sections</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">regions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;All 2D points assigned to the same region and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_without_regions</span><span class="p">(</span>
                <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to regions using DeltaShell and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_with_deltashell</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">regions</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;region&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to regions using Built-In method and classifying points to cross-sections&quot;</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_with_builtin_methods</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">regions</span>
            <span class="p">)</span>

        <span class="c1"># Classify sections for roughness tables</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning point to sections without polygons&quot;</span><span class="p">)</span>
            <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_roughness_sections_by_variance</span><span class="p">(</span>
                <span class="n">edge_data</span><span class="p">,</span> <span class="n">time_dependent_data</span><span class="p">[</span><span class="s2">&quot;chezy_edge&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_roughness_sections_by_variance</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">time_dependent_data</span><span class="p">[</span><span class="s2">&quot;chezy_mean&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;classificationmethod&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning 2D points to sections using DeltaShell&quot;</span><span class="p">)</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_section_with_deltashell</span><span class="p">(</span>
                <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Assigning 2D points to sections using Built-In method&quot;</span>
            <span class="p">)</span>
            <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_roughness_sections_by_polygon</span><span class="p">(</span>
                <span class="n">sections</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">time_independent_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_roughness_sections_by_polygon</span><span class="p">(</span>
                <span class="n">sections</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">time_dependent_data</span><span class="p">,</span>
            <span class="n">time_independent_data</span><span class="p">,</span>
            <span class="n">edge_data</span><span class="p">,</span>
            <span class="n">node_coordinates</span><span class="p">,</span>
            <span class="n">cssdata</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_classify_with_builtin_methods</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">polygons</span>
    <span class="p">):</span>
        <span class="c1"># Determine in which region each cross-section lies</span>
        <span class="n">css_regions</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">cssdata</span><span class="p">[</span><span class="s2">&quot;xy&quot;</span><span class="p">])</span>

        <span class="c1"># Determine in which region each 2d point lies</span>
        <span class="n">xy_tuples_2d</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_independent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)))</span>
        <span class="p">]</span>

        <span class="n">time_independent_data</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">xy_tuples_2d</span><span class="p">)</span>

        <span class="n">xy_tuples_2d</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)))</span>
        <span class="p">]</span>

        <span class="n">edge_data</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">xy_tuples_2d</span><span class="p">)</span>

        <span class="c1"># Do Nearest neighbour cross-section for each region</span>
        <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_with_regions</span><span class="p">(</span>
            <span class="n">regions</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">css_regions</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

    <span class="k">def</span> <span class="nf">_classify_section_with_deltashell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">):</span>

        <span class="c1"># Determine in which section each 2D point lies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning faces...&quot;</span><span class="p">)</span>
        <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;section&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning edges...&quot;</span><span class="p">)</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">edge_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;section&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

    <span class="k">def</span> <span class="nf">_classify_with_deltashell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">polygons</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="s2">&quot;region&quot;</span>
    <span class="p">):</span>

        <span class="c1"># Determine in which region each 2D point lies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning faces...&quot;</span><span class="p">)</span>
        <span class="n">time_independent_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="n">polytype</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Assigning edges...&quot;</span><span class="p">)</span>
        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_polygon_using_deltashell</span><span class="p">(</span>
            <span class="n">edge_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="o">=</span><span class="n">polytype</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
            <span class="s2">&quot;Assigning cross-sections using nearest neighbour within regions...&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Determine in which region each cross-section lies</span>
        <span class="n">css_regions</span> <span class="o">=</span> <span class="n">polygons</span><span class="o">.</span><span class="n">classify_points</span><span class="p">(</span><span class="n">cssdata</span><span class="p">[</span><span class="s2">&quot;xy&quot;</span><span class="p">])</span>

        <span class="c1"># Do Nearest neighbour cross-section for each region</span>
        <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">classify_with_regions</span><span class="p">(</span>
            <span class="n">polygons</span><span class="p">,</span> <span class="n">cssdata</span><span class="p">,</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span><span class="p">,</span> <span class="n">css_regions</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">time_independent_data</span><span class="p">,</span> <span class="n">edge_data</span>

<div class="viewcode-block" id="Fm2ProfRunner._classify_roughness_sections_by_variance"><a class="viewcode-back" href="../../chapters/technical_manual/numerical_methods.html#fm2prof.Fm2ProfRunner.Fm2ProfRunner._classify_roughness_sections_by_variance">[docs]</a>    <span class="k">def</span> <span class="nf">_classify_roughness_sections_by_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method classifies the region into main channel and floodplain based on roughness. It</span>
<span class="sd">        is used when the user does not specify a section polygon.</span>

<span class="sd">        This method assumes that the main channel is much deeper than the floodplain. Therefore,</span>
<span class="sd">        the Chzy values will be higher than those in the floodplain. The objective is now to</span>
<span class="sd">        define a split-value that minimizes the variance of the split sets.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Variance reduction classification is method often used in decision tree learning,</span>
<span class="sd">            e.g. see https://en.wikipedia.org/wiki/Decision_tree_learning#Variance_reduction</span>
<span class="sd">            for more information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get chezy values at last timestep</span>
        <span class="n">end_values</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;section&quot;</span>

        <span class="c1"># Find split point (chezy value) by variance minimisation</span>
        <span class="n">variance_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">split_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">end_values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">end_values</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">split_candidates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span>
        <span class="p">):</span>  <span class="c1"># this means that all end values are very close together, so do not split</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][:]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">split_candidates</span><span class="p">:</span>
                <span class="n">variance_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">end_values</span><span class="p">[</span><span class="n">end_values</span> <span class="o">&gt;</span> <span class="n">split</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">end_values</span><span class="p">[</span><span class="n">end_values</span> <span class="o">&lt;=</span> <span class="n">split</span><span class="p">]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="n">splitpoint</span> <span class="o">=</span> <span class="n">split_candidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanargmin</span><span class="p">(</span><span class="n">variance_list</span><span class="p">)]</span>

            <span class="c1"># High chezy values are assigned to section number &#39;1&#39; (Main channel)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">end_values</span> <span class="o">&gt;</span> <span class="n">splitpoint</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Low chezy values are assigned to section number &#39;2&#39; (Flood plain)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">end_values</span> <span class="o">&lt;=</span> <span class="n">splitpoint</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">_get_region_map_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polytype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the path to a NC file with region ifnormation in the bathymetry data&quot;&quot;&quot;</span>
        <span class="n">map_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="s2">&quot;2DMapOutput&quot;</span><span class="p">)</span>
        <span class="n">filepath</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">map_file_path</span><span class="p">)</span>
        <span class="n">modified_file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polytype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">BATHY</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">modified_file_path</span>

    <span class="k">def</span> <span class="nf">_assign_polygon_using_deltashell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="n">polytype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;region&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign all 2D points using DeltaShell method&quot;&quot;&quot;</span>

        <span class="c1"># NOTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for _</span><span class="si">{</span><span class="n">polytype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">BATHY.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>

        <span class="n">path_to_modified_nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_region_map_file</span><span class="p">(</span><span class="n">polytype</span><span class="p">)</span>

        <span class="c1"># Load Modified NetCDF</span>
        <span class="k">with</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_to_modified_nc</span><span class="p">)</span> <span class="k">as</span> <span class="n">nf</span><span class="p">:</span>
            <span class="c1"># Data stored in node z, while fm2prof uses data at faces or edges.</span>
            <span class="n">region_at_node</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mesh2d_node_z&quot;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;face&quot;</span><span class="p">:</span>
                <span class="n">node_to_face</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mesh2d_face_nodes&quot;</span><span class="p">)[:]</span><span class="o">.</span><span class="n">data</span>
                <span class="n">region_at_face</span> <span class="o">=</span> <span class="n">region_at_node</span><span class="p">[</span><span class="n">node_to_face</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">polytype</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_at_face</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;edge&quot;</span><span class="p">:</span>
                <span class="n">node_to_edge</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;edge_nodes&quot;</span><span class="p">]</span>
                <span class="n">region_at_edge</span> <span class="o">=</span> <span class="n">region_at_node</span><span class="p">[</span><span class="n">node_to_edge</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">polytype</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_at_edge</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_generate_geojson_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates geojson file based on cross sections.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            output_dir {str} -- Output directory path.</span>
<span class="sd">            cross_sections {list} -- List of Cross Sections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pointtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;face&quot;</span><span class="p">,</span> <span class="s2">&quot;edge&quot;</span><span class="p">]:</span>
            <span class="n">output_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_output.geojson&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pointtype</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_points</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">node_point</span>
                    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">cross_sections</span>
                    <span class="k">for</span> <span class="n">node_point</span> <span class="ow">in</span> <span class="n">cs</span><span class="o">.</span><span class="n">get_point_list</span><span class="p">(</span><span class="n">pointtype</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Collected points, dumping to file&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span>
                <span class="p">)</span>
                <span class="n">MaskOutputFile</span><span class="o">.</span><span class="n">write_mask_output_file</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="n">node_points</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                    <span class="s2">&quot;Error while generation .geojson file,&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;Reason: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_cross_section_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates cross sections based on the given fm_model_data</span>

<span class="sd">        Arguments:</span>
<span class="sd">            input_param_dict {Mapping[str, list]}</span>
<span class="sd">                -- Dictionary of parameters read from IniFile</span>
<span class="sd">            fm_model_data {FmModelData}</span>
<span class="sd">                -- Class with all necessary data for generating Cross Sections</span>

<span class="sd">        Returns:</span>
<span class="sd">            {list} -- List of generated cross sections</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cross_sections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cross_sections</span>

        <span class="c1"># Preprocess css from fm_model_data so it&#39;s easier to handle it.</span>
        <span class="n">css_data_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">css_data_list</span>

        <span class="c1"># Set the number of cross-section for progress bar</span>
        <span class="n">css_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_css_range</span><span class="p">(</span><span class="n">number_of_css</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">css_data_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">set_number_of_iterations</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">css_selection</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Generate cross-sections one by one</span>
        <span class="k">for</span> <span class="n">css_data</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">css_data_list</span><span class="p">)[</span><span class="n">css_selection</span><span class="p">]:</span>
            <span class="n">generated_cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_cross_section</span><span class="p">(</span>
                <span class="n">css_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">generated_cross_section</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cross_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generated_cross_section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_sections</span>

    <span class="k">def</span> <span class="nf">_get_css_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_css</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parses the CssSelection keyword from the inifile&quot;&quot;&quot;</span>
        <span class="n">cssSelection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;CssSelection&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cssSelection</span><span class="p">:</span>
            <span class="n">cssSelection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_css</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cssSelection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cssSelection</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cssSelection</span>

    <span class="k">def</span> <span class="nf">_generate_cross_section</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">css_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">fm_model_data</span><span class="p">:</span> <span class="n">FmModelData</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generates a cross section and configures its values based</span>
<span class="sd">        on the input parameter dictionary</span>

<span class="sd">        Arguments:</span>
<span class="sd">            css_data {dict}</span>
<span class="sd">                -- Dictionary of data for the current cross section</span>
<span class="sd">            input_param_dict {Mapping[str,list]}</span>
<span class="sd">                -- Dictionary with input parameters</span>
<span class="sd">            fm_model_data {FmModelData}</span>
<span class="sd">                -- Data to assign to the new cross section</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If no css_data is given.</span>
<span class="sd">            Exception: If no input_param_dict is given.</span>
<span class="sd">            Exception: If no fm_model_data is given.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {CrossSection} -- New Cross Section</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">css_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No data was given to create a Cross Section&quot;</span><span class="p">)</span>

        <span class="n">css_name</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_name</span><span class="p">:</span>
            <span class="n">css_name</span> <span class="o">=</span> <span class="s2">&quot;new_cross_section&quot;</span>

        <span class="k">if</span> <span class="n">fm_model_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;No FM data given for new cross section </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_new_log_task</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">css_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create cross section</span>
        <span class="n">created_css</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_new_cross_section</span><span class="p">(</span><span class="n">css_data</span><span class="o">=</span><span class="n">css_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">created_css</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No Cross-section could be generated for </span><span class="si">{</span><span class="n">css_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">created_css</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There are too little 2D points in control volume to construct cross-section&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Initiated new cross-section&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cross_section_geometry</span><span class="p">(</span><span class="n">cross_section</span><span class="o">=</span><span class="n">created_css</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_cross_section_roughness</span><span class="p">(</span><span class="n">cross_section</span><span class="o">=</span><span class="n">created_css</span><span class="p">)</span>

        <span class="c1"># if self.get_inifile().get_parameter(&#39;ExportMapFiles&#39;):</span>
        <span class="n">created_css</span><span class="o">.</span><span class="n">set_face_output_list</span><span class="p">()</span>
        <span class="n">created_css</span><span class="o">.</span><span class="n">set_edge_output_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">created_css</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">get_elapsed_time</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cross-section </span><span class="si">{</span><span class="n">created_css</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> derived in </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> s&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">created_css</span>

    <span class="k">def</span> <span class="nf">_build_cross_section_geometry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method manages the options of buildling the cross-section geometry</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cross_section {CrossSection}</span>
<span class="sd">                -- Given Cross Section.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cross_section</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">css_name</span> <span class="o">=</span> <span class="n">cross_section</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Build cross-section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Start building geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">build_geometry</span><span class="p">()</span>

        <span class="c1"># 2D Volume Correction (SummerDike option)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;SDCorrection&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Starting correction&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
            <span class="n">cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perform_2D_volume_correction</span><span class="p">(</span><span class="n">cross_section</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;SD Correction not enable in configuration file, skipping&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Perform sanity check on cross-section</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">check_requirements</span><span class="p">()</span>

        <span class="c1"># Reduce number of points in cross-section</span>
        <span class="n">cross_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_css_points</span><span class="p">(</span><span class="n">cross_section</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_build_cross_section_roughness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the roughness tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Assign roughness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Starting computing roughness tables&quot;</span><span class="p">,</span> <span class="s2">&quot;debug&quot;</span><span class="p">)</span>
        <span class="n">cross_section</span><span class="o">.</span><span class="n">assign_roughness</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Computed roughness&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_get_new_cross_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">css_data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Creates a cross section with the given input param dictionary.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            css_data {Mapping[str, str]}</span>
<span class="sd">                -- FM Model data for cross section.</span>
<span class="sd">            input_param_dict {Mapping[str, str]}</span>
<span class="sd">                -- Dictionary with parameters for Cross Section.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {CrossSection} -- New cross section object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get id data and id index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">css_data_id</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">css_data_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get remainig data</span>
        <span class="n">css_data_length</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">)</span>
        <span class="n">css_data_location</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
        <span class="n">css_data_branch_id</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;branchid&quot;</span><span class="p">)</span>
        <span class="n">css_data_chainage</span> <span class="o">=</span> <span class="n">css_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;chainage&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">css_data_length</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_location</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_branch_id</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">css_data_chainage</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="n">CrossSection</span><span class="p">(</span>
                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(),</span>
                <span class="n">inifile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">(),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">css_data_id</span><span class="p">,</span>
                <span class="n">length</span><span class="o">=</span><span class="n">css_data_length</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">css_data_location</span><span class="p">,</span>
                <span class="n">branchid</span><span class="o">=</span><span class="n">css_data_branch_id</span><span class="p">,</span>
                <span class="n">chainage</span><span class="o">=</span><span class="n">css_data_chainage</span><span class="p">,</span>
                <span class="n">fm_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fm_model_data</span><span class="o">.</span><span class="n">get_selection</span><span class="p">(</span><span class="n">css_data_id</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown while creating cross-section &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, message: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">css_data_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">css</span>

    <span class="k">def</span> <span class="nf">_write_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports all cross sections to the necessary file formats</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cross_sections {list}</span>
<span class="sd">                -- List of created cross sections</span>
<span class="sd">            output_dir {str}</span>
<span class="sd">                -- target directory where to export all the cross sections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cross_sections</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_dir</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">OutputExporter</span> <span class="o">=</span> <span class="n">Export1DModelData</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">())</span>

        <span class="c1"># File paths</span>
        <span class="n">css_location_ini_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;CrossSectionLocations.ini&quot;</span><span class="p">)</span>
        <span class="n">css_definitions_ini_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;CrossSectionDefinitions.ini&quot;</span>
        <span class="p">)</span>

        <span class="n">csv_geometry_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">geometry.csv&quot;</span>
        <span class="n">csv_roughness_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness.csv&quot;</span>

        <span class="n">csv_geometry_test_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">geometry_test.csv&quot;</span>
        <span class="n">csv_roughness_test_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness_test.csv&quot;</span>

        <span class="n">csv_volumes_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">volumes.csv&quot;</span>

        <span class="c1"># export fm1D format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Export locations</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_crossSectionLocations</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">css_location_ini_file</span>
            <span class="p">)</span>

            <span class="c1"># Export definitions</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">css_definitions_ini_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;dflow1d&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Export roughness</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">css</span> <span class="ow">in</span> <span class="n">cross_sections</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">css</span><span class="o">.</span><span class="n">friction_tables</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="p">)</span>
            <span class="n">sectionFileKeyDict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-Main.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;Main&quot;</span><span class="p">],</span>
                <span class="s2">&quot;floodplain1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-FloodPlain1.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;FloodPlain1&quot;</span><span class="p">],</span>
                <span class="s2">&quot;floodplain2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">roughness-FloodPlain2.ini&quot;</span><span class="p">,</span> <span class="s2">&quot;FloodPlain2&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
                <span class="n">csv_roughness_ini_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="n">sectionFileKeyDict</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_roughness</span><span class="p">(</span>
                    <span class="n">cross_sections</span><span class="p">,</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">csv_roughness_ini_file</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;dflow1d&quot;</span><span class="p">,</span>
                    <span class="n">roughness_section</span><span class="o">=</span><span class="n">sectionFileKeyDict</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files to DIMR format,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Eport SOBEK 3 format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Cross-sections</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_geometry_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;sobek3&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Roughness</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_roughness</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_roughness_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;sobek3&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files to SOBEK format,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Other files:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_geometry</span><span class="p">(</span>
                <span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_geometry_test_file</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;testformat&quot;</span>
            <span class="p">)</span>

            <span class="n">OutputExporter</span><span class="o">.</span><span class="n">export_volumes</span><span class="p">(</span><span class="n">cross_sections</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">csv_volumes_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;An error was produced while exporting files,&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; not all output files might be exported. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e_info</span><span class="p">)),</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;Exported output files, FM2PROF finished&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reduce_css_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_section</span><span class="p">:</span> <span class="n">CrossSection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a valid value for the number of css points read from ini file.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            cross_section (CrossSection)</span>

<span class="sd">        Returns:</span>
<span class="sd">            cross_section (CrossSection): modified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">maximum_number_of_css_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;MaximumPointsInProfile&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cross_section</span><span class="o">.</span><span class="n">reduce_points</span><span class="p">(</span><span class="n">count_after</span><span class="o">=</span><span class="n">maximum_number_of_css_points</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown while trying to reduce the css points. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_message</span><span class="p">),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cross_section</span>

    <span class="k">def</span> <span class="nf">_get_time_stamp_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a time stamp with the time difference</span>

<span class="sd">        Arguments:</span>
<span class="sd">            start_time {datetime} -- Initial date time</span>

<span class="sd">        Returns:</span>
<span class="sd">            {float} -- difference of time between start and now in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">time_difference</span> <span class="o">=</span> <span class="n">time_now</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">return</span> <span class="n">time_difference</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_perform_2D_volume_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">css</span><span class="p">:</span> <span class="n">CrossSection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CrossSection</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In 2D, the volume available in a profile can rise rapidly</span>
<span class="sd">        while the water level changes little due to compartimentalisation</span>
<span class="sd">        of the floodplain. This methods calculates a logistic correction</span>
<span class="sd">        term which may be applied in 1D models.</span>

<span class="sd">        In SOBEK this option is available as the &#39;summerdike&#39; options.</span>
<span class="sd">        Calculates the Cross Section correction if needed.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get value, it should already come as a float.</span>
        <span class="n">sd_transition_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="s2">&quot;SDTransitionHeight&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">css</span><span class="o">.</span><span class="n">calculate_correction</span><span class="p">(</span><span class="n">sd_transition_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="s2">&quot;correction finished&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e_error</span><span class="p">:</span>
            <span class="n">e_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e_error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span>
                <span class="s2">&quot;Exception thrown &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;while trying to calculate the correction. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e_message</span><span class="p">),</span>
                <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">css</span>

    <span class="k">def</span> <span class="nf">_print_log_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_logformatter</span><span class="p">()</span><span class="o">.</span><span class="n">_loglibrary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warnings: </span><span class="si">{</span><span class="n">ll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_logger_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Errors: </span><span class="si">{</span><span class="n">ll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Project"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project">[docs]</a><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">Fm2ProfRunner</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides the main API for running FM2PROF.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Project.set_parameter"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the value of a parameter</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the parameter (case insensitive).</span>

<span class="sd">            value: value of the parameter. An error will be given if the value has the wrong type (e.g. string if int was expected).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_parameter"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to get the value of a parameter</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the parameter (case insensitive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current value of the parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.set_input_file"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the path to an input file</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name: name of the input file in the configuration (case insensitive).</span>

<span class="sd">            value: path to the inputfile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_input_file</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_input_file"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to retrieve the path to an input file</span>

<span class="sd">        Arguments:</span>
<span class="sd">            name (str): case-insensitive key of the input file (e.g.&#39;2dmapoutput&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_input_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.set_output_directory"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.set_output_directory">[docs]</a>    <span class="k">def</span> <span class="nf">set_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to set the output directory.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            calling this function will also create the output directory,</span>
<span class="sd">            if it does not already exists!</span>

<span class="sd">        Arguments:</span>
<span class="sd">            path: path to the output path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">set_output_directory</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Project.get_output_directory"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.get_output_directory">[docs]</a>    <span class="k">def</span> <span class="nf">get_output_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current output directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">get_output_directory</span><span class="p">()</span></div>

<div class="viewcode-block" id="Project.print_configuration"><a class="viewcode-back" href="../../chapters/user_manual/source.html#fm2prof.Fm2ProfRunner.Project.print_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">print_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use this method to obtain string representation of the</span>
<span class="sd">        configuration. Use this string to write to file, e.g.:</span>

<span class="sd">            &gt;&gt; with open(&#39;EmptyProject.ini&#39;, &#39;w&#39;) as f:</span>
<span class="sd">            &gt;&gt;     f.write(project.print_configuration())</span>

<span class="sd">        Returns:</span>
<span class="sd">            string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inifile</span><span class="p">()</span><span class="o">.</span><span class="n">print_configuration</span><span class="p">()</span></div></div>
</pre></div>

        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FM2PROF</div>
      <div>
        
        <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/user_manual/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../chapters/technical_manual/index.html">Technical Reference Manual</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2020, Deltares.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.5.0 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>